<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1,viewport-fit=cover" name="viewport"/>
<title>Alumil Admin Panel</title>
<!-- Favicons -->
<link href="favicon/apple-touch-icon.png?v=6" rel="apple-touch-icon" sizes="180x180"/>
<link href="favicon/favicon-32x32.png?v=6" rel="icon" sizes="32x32" type="image/png"/>
<link href="favicon/favicon-16x16.png?v=6" rel="icon" sizes="16x16" type="image/png"/>
<link href="favicon/favicon.svg?v=6" rel="icon" type="image/svg+xml"/>
<link href="favicon/site.webmanifest?v=6" rel="manifest"/>
<link color="#ffc107" href="favicon/safari-pinned-tab.svg?v=6" rel="mask-icon"/>
<link href="favicon/favicon.ico?v=6" rel="shortcut icon"/>
<meta content="#ffc107" name="msapplication-TileColor"/>
<meta content="favicon/browserconfig.xml?v=6" name="msapplication-config"/>
<meta content="#ffffff" name="theme-color"/>
<script src="https://cdn.tailwindcss.com"></script><link href="assets/css/logo-theme.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" referrerpolicy="no-referrer" rel="stylesheet"/>
<script defer="" src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.4/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<!-- Footer Styles -->
<style>
    .alumil-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      padding: 12px 0;
      text-align: center;
      font-size: 12px;
      color: #666;
      z-index: 1000;
      font-family: Inter, system-ui, sans-serif;
    }
    
    [data-theme="dark"] .alumil-footer {
      background: rgba(31, 41, 55, 0.95);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: #9ca3af;
    }
    
    .alumil-footer p {
      margin: 0;
      font-weight: 500;
    }
    
    /* Add bottom padding to main content to account for fixed footer */
    main, body {
      padding-bottom: 60px;
    }
    
    /* Logo Theme Switching */
    .alumil-header-logo {
      transition: opacity 0.2s ease;
    }
    
    [data-theme="light"] .alumil-header-logo {
      content: url('assets/images/alumil-logo-dark.svg');
    }
    
    [data-theme="dark"] .alumil-header-logo {
      content: url('assets/images/alumil-logo-white.svg');
    }
  </style>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    :root { --header-h: 80px; }
    html, body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
    body{ transition:background-color .3s, color .3s; background:#2a2a2a; color:#d1d5db; }
    .card{ background:#1a1a1a; border:1px solid #2f3340; border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,.25); }
    .subtitle-text{ color:#a1a1b5; }
    .input-field{ background:#2a2a2a; border:1px solid #4b5563; color:#d1d5db; padding:.75rem 1rem; border-radius:.75rem; transition:border-color .2s, box-shadow .2s; }
    .input-field:focus{ outline: none; border-color:#f59e0b; box-shadow:0 0 0 2px rgba(245,158,11,.35); }
    .btn{ display:inline-flex; align-items:center; gap:.5rem; padding:.675rem 1rem; border-radius:.75rem; border:1px solid transparent; font-weight:600; }
    .btn-amber{ background:#f59e0b; color:#111827; }
    .btn-amber:hover{ filter:brightness(.95); }
    .btn-ghost{ border-color:#3b4254; background:transparent; color:#d1d5db; }
    .btn-ghost:hover{ background:#111827; }
    .icon-btn{ display:inline-grid; place-items:center; width:38px; height:38px; border-radius:10px; border:1px solid #3b4254; background:transparent; color:inherit; }
    .icon-btn:hover{ background:#0f172a; }
    .chip{ display:inline-flex; align-items:center; gap:.375rem; padding:.25rem .6rem; border-radius:999px; font-size:.7rem; font-weight:700; }
    .chip.ok{ background:rgba(16,185,129,.15); color:#10b981; }
    .chip.warn{ background:rgba(251,191,36,.15); color:#f59e0b; }
    .chip.bad{ background:rgba(239,68,68,.15); color:#ef4444; }
    .chip.filter{ background:#0b1220; color:#cbd5e1; border:1px solid #293042; }

    .sticky-utility{ position: sticky; top: calc(var(--header-h) + 10px); z-index: 40; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); border-radius: 14px; }
    .seg { border:1px solid #3b4254; border-radius:12px; overflow:hidden; }
    .seg > button{ padding:.55rem .9rem; font-weight:600; }
    .seg > button:hover{ background:#0f172a; }
    .seg [data-active="true"]{ background:#f59e0b; color:#0f172a; }

    html[data-theme="light"] body { background:#f3f4f6; color:#374151; }
    html[data-theme="light"] .card { background:#fff; border-color:#e5e7eb; box-shadow:0 6px 24px rgba(0,0,0,.08); }
    html[data-theme="light"] .subtitle-text{ color:#6b7280; }
    html[data-theme="light"] .input-field{ background:#fff; border-color:#d1d5db; color:#111827; }
    html[data-theme="light"] .seg { border-color:#e5e7eb; }
    html[data-theme="light"] .seg > button:hover{ background:#f3f4f6; }
    html[data-theme="light"] .icon-btn{ border-color:#e5e7eb; }
    html[data-theme="light"] .icon-btn:hover{ background:#f3f4f6; }
    html[data-theme="light"] .chip.filter{ background:#f1f5f9; color:#334155; border-color:#e2e8f0; }

    @keyframes header-glow{
      0%,100%{ box-shadow:0 10px 15px -3px rgba(0,0,0,.2), 0 4px 6px -4px rgba(0,0,0,.2); }
      50%{ box-shadow:0 12px 28px -6px rgba(245,158,11,.25), 0 6px 10px -5px rgba(245,158,11,.18); }
    }
    .animating{ animation: header-glow 4s ease-in-out infinite; }

    .brand-full { display:none; }
    .brand-short { display:inline; }
    @media (min-width: 640px){
      .brand-full { display:inline; }
      .brand-short { display:none; }
    }

    .img-ph { display:grid; place-items:center; width:3.5rem; height:3.5rem; border-radius:.5rem; border:1px dashed #475569; background:#0b1220; color:#94a3b8; font-size:.7rem; text-transform:uppercase; letter-spacing:.03em; }
    .img-ph-lg { width:12rem; height:12rem; border-radius:.75rem; font-size:.9rem; }
  
/* --- Fixed bottom navigation always visible --- */
html, body { height: 100%; margin: 0; padding: 0; overflow-x: hidden; }
#alumil-bottom-nav { position: fixed !important; bottom: 0 !important; left: 0 !important; right: 0 !important; z-index: 1000 !important; padding-bottom: env(safe-area-inset-bottom); }
#alumil-fixed-footer { position: fixed !important; bottom: 0 !important; width: 100% !important; z-index: 999 !important; }
body { position: relative; min-height: 100vh; -webkit-overflow-scrolling: touch; }
  </style>
<script>
    (function(){
      try{
        var t = localStorage.getItem('alumil:theme') || localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', t);
      }catch(e){ document.documentElement.setAttribute('data-theme', 'light'); }
    })();
  </script>
<!-- Dynamic header height + subtle extra gap (prevents mobile overlap) -->
<script>
    (function(){
      function setHeaderVar(){
        var header = document.getElementById('header');
        if(!header) return;
        var h = header.getBoundingClientRect().height || 80;
        // Add a little breathing room below the header for mobile
        document.documentElement.style.setProperty('--header-h', (h + 12) + 'px');
        // Ensure header stays on top of moving content
        header.style.zIndex = 70;
      }
      window.addEventListener('load', setHeaderVar);
      window.addEventListener('resize', setHeaderVar);
      window.addEventListener('orientationchange', setHeaderVar);
      if ('ResizeObserver' in window) {
        var ro = new ResizeObserver(setHeaderVar);
        window.addEventListener('DOMContentLoaded', function(){
          var header = document.getElementById('header');
          if (header) ro.observe(header);
        });
      }
    })();
  </script>
<style>
    /* Logo theme swap (auto) */
    .logo-swap { display:inline-flex; align-items:center; gap:.5rem; }
    .logo-swap .logo-light { display:inline; }
    .logo-swap .logo-dark  { display:none; }
    .dark  .logo-swap .logo-light, [data-theme="dark"]  .logo-swap .logo-light { display:none; }
    .dark  .logo-swap .logo-dark,  [data-theme="dark"]  .logo-swap .logo-dark  { display:inline; }
    [data-theme="light"] .logo-swap .logo-light { display:inline; }
    [data-theme="light"] .logo-swap .logo-dark  { display:none; }
    </style><link as_="image" href="assets/images/alumil-logo-black.png" rel="preload"/><link as_="image" href="assets/images/alumil-logo-white.png" rel="preload"/><style>
/* Logo theme swap (SVG) */
.logo-swap { display:inline-flex; align-items:center; gap:.75rem; }
.logo-swap .logo-light { display:inline; }
.logo-swap .logo-dark  { display:none; }
.dark .logo-swap .logo-light, [data-theme="dark"] .logo-swap .logo-light { display:none; }
.dark .logo-swap .logo-dark,  [data-theme="dark"] .logo-swap .logo-dark  { display:inline; }
[data-theme="light"] .logo-swap .logo-light { display:inline; }
[data-theme="light"] .logo-swap .logo-dark  { display:none; }
.brand-title { white-space:nowrap; }
</style><link as_="image" href="assets/images/alumil-logo-black.svg" rel="preload"/><link as_="image" href="assets/images/alumil-logo-white.svg" rel="preload"/><style>
/* Inline SVG logo swap */
.logo-swap { display:inline-flex; align-items:center; gap:.75rem; }
.logo-light, .logo-dark { line-height:0; display:inline; }
.dark .logo-light, [data-theme="dark"] .logo-light { display:none; }
.dark .logo-dark,  [data-theme="dark"] .logo-dark  { display:inline; }
[data-theme="light"] .logo-light { display:inline; }
[data-theme="light"] .logo-dark  { display:none; }
.logo-swap svg { width:156px; height:auto; display:block; }
</style><style>
/* Single-logo themed via currentColor (v2) */
.brand-logo { display:inline-block; line-height:0; color:#111; }
.brand-logo svg { width:156px; height:auto; display:block; }
.dark .brand-logo, [data-theme="dark"] .brand-logo { color:#EDEDED; }
@media (prefers-color-scheme: dark) {
  :root:not(.dark):not([data-theme="light"]) .brand-logo { color:#EDEDED; }
}
</style><style>    .btn-primary{background:#ffc107;color:#1a1a1a;font-weight:600;padding:.75rem 1.5rem;border-radius:.5rem;transition:background-color .3s,transform .2s}
    .btn-primary:hover{background:#f59e0b;transform:translateY(-2px)}

    .btn-scan{
      width:44px;height:44px;border-radius:12px;display:inline-grid;place-items:center;
      background:#facc15; color:#111827; border:none;
      box-shadow:0 0 0 0 rgba(250,204,21,0);
      transition:transform .15s, box-shadow .2s, background .2s;
    }
    .btn-scan:hover{
      background:#f59e0b;
      box-shadow:0 0 0 6px rgba(250,204,21,.18);
    }
    .btn-scan:active{ transform:translateY(1px) scale(.98); }
    html[data-theme="light"] .btn-scan{ color:#111827; }

    .no-scroll{overflow:hidden;touch-action:none}

    /* Scanner modal */
    .modal{
      display:none; position:fixed; inset:0; z-index:100;
      place-items:center; padding:16px;
      background:rgba(0,0,0,.6);
      -webkit-backdrop-filter:blur(4px); backdrop-filter:blur(4px);
      opacity:0; transition:opacity .2s; overscroll-behavior:contain;
    }
    .modal.open{display:grid;opacity:1}
    .modal-panel{
      width:92vw; max-width:720px; background:#111827; border:1px solid #374151; border-radius:1rem; padding:1rem;
      max-height:min(90svh,720px); max-height:calc(100dvh - 2rem); overflow:auto;
      padding-bottom:calc(1rem + env(safe-area-inset-bottom));
    }
    .video-wrap{position:relative;overflow:hidden;border-radius:.75rem;background:#000}
    #scanVideo{width:100%;height:auto;display:block}
    .scan-line{position:absolute;left:0;right:0;top:50%;height:2px;background:#22c55e;box-shadow:0 0 12px #22c55e;animation:scan 2s linear infinite}
    @keyframes scan{0%{top:15%}50%{top:85%}100%{top:15%}}

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}
    }
  
/* --- Fixed bottom navigation always visible --- */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
}
#alumil-bottom-nav {
  position: fixed !important;
  bottom: 0 !important;
  left: 0 !important;
  right: 0 !important;
  z-index: 1000 !important;
  padding-bottom: env(safe-area-inset-bottom);
}
#alumil-fixed-footer {
  position: fixed !important;
  bottom: 0 !important;
  width: 100% !important;
  z-index: 999 !important;
}
body {
  position: relative;
  min-height: 100vh;
  -webkit-overflow-scrolling: touch;
}
</style></head>
<body class="light">
<header class="app-header fixed top-0 left-0 right-0 z-20 w-full flex flex-col sm:flex-row justify-between items-center p-2 sm:p-3 rounded-xl shadow-lg card dark animating" id="header">
<div class="flex items-center space-x-2 sm:space-x-3 mb-4 sm:mb-0">
<div class="logo-container">
<img alt="Alumil Logo" loading="eager" src="assets/images/alumil-logo.svg"/>
</div>
<span class="brand-title font-semibold text-lg sm:text-2xl tracking-tight hidden sm:inline">Alumil Inventory System</span>
<span class="brand-title font-semibold text-sm tracking-tight sm:hidden">Alumil</span>
</div>
<nav class="flex items-center space-x-4 text-sm sm:text-base">
<a class="flex items-center gap-2 icon-color font-medium" href="home.html">
  <svg class="lucide lucide-home icon-color" fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
  <span>Home</span>
</a>
<a class="flex items-center gap-2 icon-color font-medium" href="admin.html">
  <svg class="lucide lucide-user-cog icon-color" fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M18 21a8 8 0 0 0-16 0"></path><circle cx="10" cy="8" r="5"></circle><circle cx="17" cy="17" r="3"></circle><path d="M19.5 14.5l.7.7"></path><path d="M14.3 19.7l.7.7"></path><path d="M20.9 17l.7-.7"></path><path d="M15.7 14.3l-.7-.7"></path><path d="M17 11.5v-1"></path><path d="M17 21.5v-1"></path><path d="M12.5 17h-1"></path><path d="M21.5 17h-1"></path></svg>
  <span>Admin</span>
</a>
<button class="flex items-center gap-2 icon-color hover:text-red-400 transition-colors" id="logout-btn" onclick="window.AuthHelper.handleLogout()">
  <svg class="lucide lucide-log-out icon-color" fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" x2="9" y1="12" y2="12"></line></svg>
  <span>Logout</span>
</button>
<button aria-label="Toggle theme" class="flex items-center gap-2 icon-color" id="theme-toggle" style="margin-left: 0.5rem;" title="Toggle theme">
  <svg fill="none" height="20" id="theme-toggle-icon" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg">
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
  </svg>
</button>
</header>
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-[calc(var(--header-h)+48px)] pb-16">
<!-- Page title row -->
<div class="flex items-center justify-between mb-6 gap-4">
<h1 class="text-3xl font-bold title-text">Inventory Item Search</h1>
<div class="flex items-center gap-3 text-xs sm:text-sm">
<span class="hidden sm:inline subtitle-text" id="last-updated"></span>
<span class="inline-flex items-center gap-2 px-2.5 py-1 rounded-full border" id="data-pill">
<span class="inline-block w-2.5 h-2.5 rounded-full bg-orange-500" id="data-indicator"></span>
<span id="data-source-text">Sample Data</span>
</span>
</div>
</div>
<!-- Utility bar -->
<div class="sticky-utility card px-3 py-2 mb-3">
<div class="flex flex-col sm:flex-row sm:items-center gap-3 justify-between">
<div class="seg inline-flex">
<button class="px-4 py-2" data-active="true" id="seg-search"><i class="fa-solid fa-magnifying-glass mr-2"></i> Search</button>
<button class="px-4 py-2" id="seg-all">
<i class="fa-regular fa-rectangle-list mr-2"></i> View All
          <span class="ml-2 text-xs font-bold px-2 py-0.5 rounded-full bg-black/20" id="seg-count">—</span>
</button>
</div>
<div class="flex items-center gap-2">
<button class="btn btn-ghost" id="filtersBtn">
<i class="fa-solid fa-sliders"></i>
<span class="hidden sm:inline" id="filtersBtnLabel">Filters</span>
<kbd class="ml-1 text-[10px] px-1.5 py-0.5 rounded border border-current">F</kbd>
</button>
<div class="text-xs subtitle-text">
<span id="totalLabel">Total profiles:</span>
<span class="chip filter ml-1" id="allCountMirror">—</span>
</div>
</div>
</div>
</div>
<!-- Active filter chips -->
<div class="flex flex-wrap gap-2 mb-6" id="activeChips"></div>
<!-- Search section -->
<section class="card p-6" id="search-section">
<div class="grid grid-cols-1 lg:grid-cols-[1fr_auto_auto] gap-4 items-end">
<div>
<label class="block text-sm font-medium subtitle-text mb-1">Search Profile or Accessory</label>
<div class="relative">
<i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
<input class="input-field w-full pl-12" id="q" placeholder="Type code, description, or system…" type="search"/>
<div class="absolute left-0 right-0 top-full mt-2 z-50 hidden" id="sugWrap">
<ul class="card p-2 max-h-72 overflow-y-auto divide-y divide-slate-700" id="sugList"></ul>
</div>
</div>
</div>
<div class="min-w-[220px]">
<label class="block text-sm font-medium subtitle-text mb-1">Item Type</label>
<select class="input-field w-full" id="kindSel">
<option selected="" value="profile">Profile</option>
<option value="accessory">Accessory</option>
</select>
</div>
<div class="flex gap-2">
<button class="btn btn-primary" id="exportCsvBtn"><i class="fa-solid fa-file-csv"></i> CSV</button>
<button class="btn btn-primary" id="exportPdfBtn"><i class="fa-solid fa-file-pdf"></i> PDF</button>
</div>
</div>
</section>
<!-- View-all section -->
<section class="card p-6 mt-6 hidden" id="viewall-section">
<div class="flex items-center justify-between mb-4">
<div class="font-medium" id="browseLabel">Browsing all profiles</div>
<button class="btn btn-ghost" id="toSearchBtn"><i class="fa-solid fa-arrow-left"></i> Back to Search</button>
</div>
<div class="text-sm subtitle-text mb-4">Tip: Press <kbd class="px-1.5 py-0.5 border border-current rounded text-[10px]">F</kbd> to open filters.</div>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="results-grid"></div>
</section>
<!-- Details panel -->
<section class="card p-6 mt-6 hidden" id="detailsPanel">
<div class="flex flex-col lg:flex-row gap-6">
<div class="flex-shrink-0 flex flex-col items-center">
<img alt="" class="w-48 h-48 object-contain rounded-lg border border-slate-700 bg-white hidden mx-auto" id="d-img" src=""/>
<div class="img-ph img-ph-lg mx-auto" id="d-img-ph">No image</div>
<div class="flex flex-col items-center mt-4">
<h3 class="text-lg font-semibold" id="d-code"></h3>
<span class="chip mt-3" id="d-status-chip"></span>
</div>
</div>
<div class="flex-1">
<div class="flex gap-4 border-b border-slate-700 mb-4">
<button class="tab-btn py-2 font-semibold border-b-2 border-transparent active" data-tab="general">General</button>
<button class="tab-btn py-2 font-semibold border-b-2 border-transparent" data-tab="profile-specific" id="profile-accessory-tab-btn">Profile Data</button>
<button class="tab-btn py-2 font-semibold border-b-2 border-transparent" data-tab="misc">Misc</button>
</div>
<div class="tab-content" id="general-tab">
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
<div><div class="text-xs subtitle-text mb-1">Description</div><div class="font-medium" id="d-desc"></div></div>
<div id="d-pdesc-container"><div class="text-xs subtitle-text mb-1">Profile Description</div><div id="d-pdesc">N/A</div></div>
<div id="d-alloy-container"><div class="text-xs subtitle-text mb-1">Alloy</div><div id="d-alloy">N/A</div></div>
<div id="d-system-container"><div class="text-xs subtitle-text mb-1">System</div><div id="d-system">N/A</div></div>
<div id="d-supported-profile-container"><div class="text-xs subtitle-text mb-1">Supported Profile</div><div id="d-supported-profile">N/A</div></div>
<div id="d-finish-container"><div class="text-xs subtitle-text mb-1">Finish</div><div id="d-finish">N/A</div></div>
<div id="d-length-container"><div class="text-xs subtitle-text mb-1">Length</div><div id="d-length">N/A</div></div>
<div id="d-atype-container"><div class="text-xs subtitle-text mb-1">Accessories Type</div><div id="d-atype">N/A</div></div>
<div id="d-mrp-container"><div class="text-xs subtitle-text mb-1">MRP Comments</div><div id="d-mrp">N/A</div></div>
<div id="d-supplier-container"><div class="text-xs subtitle-text mb-1">Supplier</div><div id="d-supplier">N/A</div></div>
<div id="d-uom-container"><div class="text-xs subtitle-text mb-1">UOM</div><div id="d-uom">N/A</div></div>
<div id="d-scode-container"><div class="text-xs subtitle-text mb-1">Supplier Code</div><div id="d-scode">N/A</div></div>
<div><div class="text-xs subtitle-text mb-1">Warehouse / Rack</div><div id="d-ware-rack">N/A</div></div>
</div>
</div>
<div class="tab-content hidden" id="profile-specific-tab">
<div class="mb-4" id="d-supplier-grid-container">
<div class="text-xs subtitle-text mb-2" data-accessory-title="Other colour codes" data-profile-title="Supplier Codes" id="supplier-title">Supplier Codes</div>
<div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3" id="d-supplier-grid"></div>
</div>
<div class="mb-4" id="d-sides-grid-container">
<div class="text-xs subtitle-text mb-2" data-accessory-title="" data-profile-title="Sides" id="sides-title">Sides</div>
<div class="grid grid-cols-2 sm:grid-cols-4 gap-3" id="d-sides-grid"></div>
</div>
<div id="d-poly-grid-container">
<div class="text-xs subtitle-text mb-2" data-accessory-title="Other colour codes" data-profile-title="Polyamide" id="poly-title">Polyamide</div>
<div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3" id="d-poly-grid"></div>
</div>
</div>
<div class="tab-content hidden" id="misc-tab">
<p class="subtitle-text text-sm">Additional information would go here.</p>
</div>
</div>
</div>
</section>
</main>
<!-- Filters Sheet -->
<div class="fixed inset-x-0 top-[calc(var(--header-h)+8px)] z-[60] max-w-7xl mx-auto px-4 sm:px-6 hidden" id="filtersSheet">
<div class="card p-4">
<div class="flex items-center justify-between mb-3">
<div class="font-semibold" id="filtersTitle">Filters</div>
<div class="flex gap-2">
<button class="btn btn-ghost" id="resetFilters"><i class="fa-solid fa-rotate"></i> Reset</button>
<button class="btn btn-primary" id="applyFilters"><i class="fa-solid fa-check"></i> Apply</button>
<button aria-label="Close filters" class="icon-btn" id="closeFilters"><i class="fa-solid fa-xmark"></i></button>
</div>
</div>
<!-- PROFILE FILTERS -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3" id="profileFilters">
<div>
<label class="block text-xs subtitle-text mb-1">System</label>
<select class="input-field w-full" id="f-system"><option value="">Any</option></select>
</div>
<div>
<label class="block text-xs subtitle-text mb-1">Finish</label>
<select class="input-field w-full" id="f-finish"><option value="">Any</option></select>
</div>
<div>
<label class="block text-xs subtitle-text mb-1">Alloy</label>
<select class="input-field w-full" id="f-alloy"><option value="">Any</option></select>
</div>
<div>
<label class="block text-xs subtitle-text mb-1">Supplier</label>
<select class="input-field w-full" id="f-supplier"><option value="">Any</option></select>
</div>
<div>
<label class="block text-xs subtitle-text mb-1">Supported</label>
<select class="input-field w-full" id="f-supported">
<option value="">Any</option>
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>
</div>
</div>
<!-- ACCESSORY FILTERS (Supplier only) -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3 hidden" id="accessoryFilters">
<div>
<label class="block text-xs subtitle-text mb-1">Supplier</label>
<select class="input-field w-full" id="fa-supplier"><option value="">Any</option></select>
</div>
</div>
</div>
</div>
<!-- Toast -->
<div class="fixed bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg text-sm text-white bg-emerald-600/90 opacity-0 transition-opacity" id="statusMessage"></div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const $ = (id) => document.getElementById(id);
  const s = (v) => (v==null ? '' : String(v));

  /* THEME TOGGLE (ids fixed to themeToggle/themeIcon) */
  const themeToggle = $('themeToggle');
  const themeIcon = $('themeIcon');
  function applyThemeIcon(theme){ themeIcon.className = theme === 'dark' ? 'fa-regular fa-sun' : 'fa-regular fa-moon'; }
  function getTheme(){ return document.documentElement.getAttribute('data-theme') || 'light'; }
  function setTheme(next){
    document.documentElement.setAttribute('data-theme', next);
    try { localStorage.setItem('alumil:theme', next); localStorage.setItem('theme', next); } catch(e){}
    applyThemeIcon(next);
  }
  applyThemeIcon(getTheme());
  themeToggle.addEventListener('click', ()=> setTheme(getTheme()==='light'?'dark':'light'));

  /* UI REFS */
  const segSearch = $('seg-search');
  const segAll = $('seg-all');
  const segCount = $('seg-count');
  const filtersBtn = $('filtersBtn');
  const allCountMirror = $('allCountMirror');
  const totalLabel = $('totalLabel');
  const browseLabel = $('browseLabel');
  const activeChips = $('activeChips');

  const searchSection = $('search-section');
  const viewAllSection = $('viewall-section');
  const resultsGrid = $('results-grid');
  const detailsPanel = $('detailsPanel');

  const q = $('q');
  const kindSel = $('kindSel');
  const sugWrap = $('sugWrap');
  const sugList = $('sugList');

  const sheet = $('filtersSheet');
  const filtersTitle = $('filtersTitle');
  const filtersBtnLabel = $('filtersBtnLabel');
  const profileFilters = $('profileFilters');
  const accessoryFilters = $('accessoryFilters');

  const fSystem = $('f-system');
  const fFinish = $('f-finish');
  const fAlloy = $('f-alloy');
  const fSupplier = $('f-supplier');
  const fSupported = $('f-supported');
  const faSupplier = $('fa-supplier');

  const applyFilters = $('applyFilters');
  const resetFilters = $('resetFilters');
  const closeFilters = $('closeFilters');

  const dataSourceText = $('data-source-text');
  const dataIndicator = $('data-indicator');
  const lastUpdated = $('last-updated');

  /* NORMALIZATION */
  const KNOWN_SUPPLIERS = ['Elite','Arabian','Qalex','Napco','TALCO','Classic','Eastern','Supplier A','Supplier B','Supplier C','Supplier D','Supplier E','Supplier F'];
  function normStr(x){ return x==null ? '' : String(x).trim(); }

  function normalizeProfile(row){
    const m = {}; for (const k in row) m[k.toLowerCase()] = row[k];
    const get = (...keys)=>{ for (const kk of keys){ if (m[kk]!=null && String(m[kk]).trim()!=='') return String(m[kk]).trim(); } return ''; };

    const pretty = (str)=>str.replace(/\s+/g,' ').trim().toLowerCase().replace(/\b\w/g,c=>c.toUpperCase());
    const cleanSupplierHeader = (header)=>{
      const h = header.toLowerCase().trim();
      let base = null; for (const sup of KNOWN_SUPPLIERS){ const s=sup.toLowerCase(); if (h.startsWith(s)) { base = sup; break; } }
      return base ? pretty(base) : null;
    };

    const profile = {
      profile_code : get('profile code','item code','code','profilecode','profile_code'),
      description  : get('description','item description','desc','descr'),
      profile_title: get('profile title','title'),
      system       : get('system','system name'),
      inventory    : get('inventory','category','status'),
      rack_no      : get('rack no','rack','rackno'),
      warehouse_no : get('warehouse no','warehouse','wh','warehouse code'),
      comments     : get('comments','mrp comments','remark','remarks'),
      alloy        : get('alloy','g'),
      finish       : get('finish','j'),
      length       : get('length','d','supported length'),
      image        : get('image url','image'),
      suppliers    : {}, sides:{}, polyamide:{}
    };

    Object.keys(m).forEach(k=>{
      const cleaned = cleanSupplierHeader(k);
      if (!cleaned) return;
      const val = normStr(m[k]); if (!val || val==='0') return;
      if (profile.suppliers[cleaned]) {
        const set = new Set(String(profile.suppliers[cleaned]).split(' / ').map(x=>x.trim()).filter(Boolean));
        if (!set.has(val)) set.add(val);
        profile.suppliers[cleaned] = Array.from(set).join(' / ');
      } else profile.suppliers[cleaned] = val;
    });

    Object.keys(m).forEach(k=>{ const mx = k.match(/^side\s*([1-4])$/i) || k.match(/^sides?\s*([1-4])$/i) || k.match(/^side_([1-4])$/i); if (mx){ const v = normStr(m[k]); if (v) profile.sides[mx[1]] = v; }});
    Object.keys(m).forEach(k=>{ const mx = k.match(/^(polyamide|poly|pa)\s*_?([1-6])$/i); if (mx){ const v = normStr(m[k]); if (v) profile.polyamide[mx[2]] = v; }});
    return profile;
  }

  function normalizeAccessory(row){
    const m = {}; for (const k in row) m[k.toLowerCase()] = row[k];
    return {
      code          : normStr(m.code || m.itemcode || m['accessory code']),
      description   : normStr(m.description || m.itemdescription),
      accessory_type: normStr(m['accessory type'] || m.accessory_type || m.type),
      supplier_name : normStr(m['supplier name'] || m.supplier_name || m.supplier || m.vendor || m.brand),
      status        : normStr(m.status || m.inventory || m.category),
      /* NEW: pick exact header “MRP comments” (and common aliases) */
      mrp_comments  : normStr(m['mrp comments'] || m.mrp_comments || m['mrp comment'] || m.mrp || m.comments),
      uom           : normStr(m.uom),
      supplier_code : normStr(m.supplier_code || m['supplier code']),
      warehouse_no  : normStr(m.warehouse_no || m['warehouse no'] || m.warehouse || m.wh),
      rack_no       : normStr(m.rack_no || m['rack no'] || m.rack || m.rackno),
      image         : normStr(m.image || m['image url']),
      supplier_codes: row.supplier_codes || {},
      other_color_codes: row.other_color_codes || {}
    };
  }

  function toArray(x){ if (Array.isArray(x)) return x; if (x && typeof x === 'object' && Array.isArray(x.rows)) return x.rows; return []; }

  /* SAMPLE (fallback) */
  const sampleData = {
    inventory: [
      { profile_code:'M11500', description:'SLIDING THERMALLY BROKEN SYSTEM WITH LIFT AND SLIDE FUNCTION', system:'SMARTIA M11500', alloy:'EN AW-6063', finish:'Anodized', length:'5.80', inventory:'OK', rack_no:'A1', warehouse_no:'W1', comments:'Main profile for sliding doors.', suppliers:{ 'Elite':'25257+25363','Supplier B':'S11500-B' }, sides:{'1':'Left','2':'Right','3':'Top','4':'Bottom'}, polyamide:{'1':'20mm','2':'18mm','3':'22mm'} },
      { profile_code:'M11520', description:'SLIDING NON-THERMALLY BROKEN SYSTEM', system:'SUPREME M11520', alloy:'EN AW-6060', finish:'Powder Coated', length:'0', inventory:'LOW', rack_no:'B2', warehouse_no:'W1', comments:'Lightweight sliding profile.', suppliers:{ 'Supplier C':'S11520-C' }, sides:{'1':'Left','2':'Right'}, polyamide:{'1':'15mm'} }
    ],
    accessories: [
      { code:'A100', description:'LOCKING MECHANISM FOR LIFT & SLIDE', accessory_type:'Locking', supplier:'Supplier L', uom:'Ea', supplier_code:'S-L100', supplier_name:'Locksmith Inc.', status:'OK', mrp_comments:'Standard locking accessory.', warehouse_no:'W1', rack_no:'Z1' }
    ]
  };

  let data = sampleData;

  (function initFromCache(){
    try{
      const cached = localStorage.getItem('excelCache');
      if (cached){
        const p = JSON.parse(cached);
        const rawProfiles = toArray(p.inventory).length ? p.inventory
                            : toArray(p.profiles).length ? p.profiles
                            : Array.isArray(p.inventory) ? p.inventory
                            : Array.isArray(p.profiles) ? p.profiles : [];
        const rawAccessories = Array.isArray(p.accessories) ? p.accessories : toArray(p.accessories);
        const normProfiles = rawProfiles.map(normalizeProfile).filter(r => s(r.profile_code) || s(r.description));
        const normAccessories = rawAccessories.map(normalizeAccessory).filter(a => s(a.code) || s(a.description));
        data = { inventory: normProfiles, accessories: normAccessories, lastUpdated: p.lastUpdated };

        dataSourceText.textContent = 'Live Data';
        dataIndicator.classList.remove('bg-orange-500'); dataIndicator.classList.add('bg-green-500');
        if (p.lastUpdated){ lastUpdated.textContent = 'Last updated: ' + new Date(p.lastUpdated).toLocaleString(); lastUpdated.classList.remove('hidden'); }
      } else {
        dataSourceText.textContent = 'Sample Data';
        dataIndicator.classList.add('bg-orange-500');
      }
    }catch(e){
      dataSourceText.textContent = 'Sample Data';
      dataIndicator.classList.add('bg-orange-500');
    }
  })();

  const INVget = () => (data.inventory || []);
  const ACCget = () => (data.accessories || []);

  function toast(msg, color){
    const el = document.getElementById('statusMessage');
    el.textContent = msg;
    el.style.backgroundColor = color || 'rgba(16,185,129,.92)';
    el.style.opacity = 1;
    setTimeout(()=>{ el.style.opacity = 0; }, 2000);
  }

  /* Tighter status classifier (handles “Discont/Discountinued”) */
  function statusClass(v){
    const t = s(v).toLowerCase();
    if (/(^|\b)(ok|in|active|avail)/.test(t)) return 'ok';
    if (/(low|hold|pending)/.test(t)) return 'warn';
    if (/(obs|discont|discountinued|discontinued|stop)/.test(t)) return 'bad';
    return '';
  }

  /* DYNAMIC LABELS / COUNTS */
  function refreshCountsAndLabels(){
    const kind = kindSel.value;
    if (kind==='profile'){
      const total = INVget().length || 0;
      segCount.textContent = total || '—';
      allCountMirror.textContent = total || '—';
      totalLabel.textContent = 'Total profiles:';
      browseLabel.textContent = 'Browsing all profiles';
      if (filtersBtnLabel) filtersBtnLabel.textContent = 'Profile Filters';
    } else {
      const total = ACCget().length || 0;
      segCount.textContent = total || '—';
      allCountMirror.textContent = total || '—';
      totalLabel.textContent = 'Total accessories:';
      browseLabel.textContent = 'Browsing all accessories';
      if (filtersBtnLabel) filtersBtnLabel.textContent = 'Accessories Filter';
    }
  }

  /* FILTER SELECT POPULATION */
  function uniq(arr){ return [...new Set(arr)].sort((a,b)=>String(a).localeCompare(String(b))); }
  function getProfileValues(key){
    const profiles = INVget();
    if (key==='supplier'){
      return uniq(profiles.flatMap(p => Object.entries(p.suppliers||{}).filter(([_,v])=>v&&v!=='0').map(([k])=>k)));
    }
    if (key==='supported'){ return ['Yes','No']; }
    return uniq(profiles.map(p => (p[key] && p[key]!=='0') ? String(p[key]).trim() : null).filter(Boolean));
  }
  function getAccessorySuppliers(){ return uniq(ACCget().map(a => a.supplier_name).filter(Boolean)); }
  function populateProfileFilterSelects(){
    const fill = (sel, values)=>{ sel.innerHTML = '<option value="">Any</option>' + values.map(v=>`<option>${v}</option>`).join(''); };
    fill(fSystem, getProfileValues('system'));
    fill(fFinish, getProfileValues('finish'));
    fill(fAlloy, getProfileValues('alloy'));
    fill(fSupplier, getProfileValues('supplier'));
  }
  function populateAccessoryFilterSelect(){ faSupplier.innerHTML = '<option value="">Any</option>' + getAccessorySuppliers().map(v=>`<option>${v}</option>`).join(''); }

  populateProfileFilterSelects();
  populateAccessoryFilterSelect();

  /* FILTER SHEET OPEN/CLOSE + MODE */
  let _bodyScrollY = 0;
  function openFilters(){
    setFilterModeByKind();
    sheet.classList.remove('hidden');

    // LOCK background to prevent the search panel from scrolling under the header on mobile
    _bodyScrollY = window.scrollY || 0;
    document.body.style.position = 'fixed';
    document.body.style.top = `-${_bodyScrollY}px`;
    document.body.style.left = '0';
    document.body.style.right = '0';
    document.body.style.width = '100%';
    document.body.style.overflow = 'hidden';
    document.body.style.touchAction = 'none';
  }
  function closeFiltersSheet(){
    sheet.classList.add('hidden');

    // UNLOCK background
    document.body.style.position = '';
    document.body.style.top = '';
    document.body.style.left = '';
    document.body.style.right = '';
    document.body.style.width = '';
    document.body.style.overflow = '';
    document.body.style.touchAction = '';
    window.scrollTo(0, _bodyScrollY || 0);
  }
  filtersBtn.addEventListener('click', openFilters);
  closeFilters.addEventListener('click', closeFiltersSheet);
  document.addEventListener('click', (e)=>{
    if (!sheet.classList.contains('hidden')){
      const panel = sheet.firstElementChild;
      if (panel && !panel.contains(e.target) && !filtersBtn.contains(e.target)) closeFiltersSheet();
    }
  });

  function setFilterModeByKind(){
    const kind = kindSel.value;
    if (kind === 'profile'){
      filtersTitle.textContent = 'Profile Filters';
      profileFilters.classList.remove('hidden');
      accessoryFilters.classList.add('hidden');
      populateProfileFilterSelects();
    } else {
      filtersTitle.textContent = 'Accessory Filters';
      profileFilters.classList.add('hidden');
      accessoryFilters.classList.remove('hidden');
      populateAccessoryFilterSelect();
    }
    refreshCountsAndLabels();
    renderActiveChips();
  }

  function getCurrentFilters(){
    if (kindSel.value === 'profile'){
      return {
        system: s(fSystem.value).trim(),
        finish: s(fFinish.value).trim(),
        alloy: s(fAlloy.value).trim(),
        supplier: s(fSupplier.value).trim(),
        supported: s(fSupported.value).trim()
      };
    } else {
      return { supplier: s(faSupplier.value).trim() };
    }
  }

  function clearFilters(){
    [fSystem,fFinish,fAlloy,fSupplier,fSupported].forEach(sel=> sel.value = '');
    faSupplier.value = '';
  }

  function renderActiveChips(){
    activeChips.innerHTML = '';
    const kind = kindSel.value;
    const f = getCurrentFilters();
    const entries = Object.entries(f).filter(([_,v])=> !!v);
    if (!entries.length) return;
    entries.forEach(([k,v])=>{
      const chip = document.createElement('button');
      chip.className = 'chip filter';
      chip.innerHTML = `<span>${(k.charAt(0).toUpperCase()+k.slice(1))}: ${v}</span> <i class="fa-solid fa-xmark text-xs"></i>`;
      chip.addEventListener('click', ()=>{
        if (kind==='profile'){
          if (k==='system') fSystem.value='';
          if (k==='finish') fFinish.value='';
          if (k==='alloy') fAlloy.value='';
          if (k==='supplier') fSupplier.value='';
          if (k==='supported') fSupported.value='';
        } else {
          if (k==='supplier') faSupplier.value='';
        }
        renderActiveChips();
        if (segAll.dataset.active === "true"){
          renderCurrentKindCards(applyFilterSet());
        }
      });
      activeChips.appendChild(chip);
    });
  }

  resetFilters.addEventListener('click', ()=>{
    clearFilters();
    renderActiveChips();
    if (segAll.dataset.active === "true"){
      renderCurrentKindCards(kindSel.value==='profile' ? INVget() : ACCget());
    }
    toast('Filters reset');
  });

  function applyFilterSet(){
    const kind = kindSel.value;
    const f = getCurrentFilters();
    if (kind === 'profile'){
      let list = INVget();
      if (f.system) list = list.filter(p => s(p.system) === f.system);
      if (f.finish) list = list.filter(p => s(p.finish) === f.finish);
      if (f.alloy) list = list.filter(p => s(p.alloy) === f.alloy);
      if (f.supplier) list = list.filter(p => Object.keys(p.suppliers||{}).includes(f.supplier));
      if (f.supported){
        list = list.filter(p => ((s(p.length) && s(p.length) !== '0') ? 'Yes':'No') === f.supported);
      }
      return list;
    } else {
      let list = ACCget();
      if (f.supplier) list = list.filter(a => s(a.supplier_name) === f.supplier);
      return list;
    }
  }

  applyFilters.addEventListener('click', ()=>{
    setSegment('all');
    renderCurrentKindCards(applyFilterSet());
    renderActiveChips();
    closeFiltersSheet();
    toast('Filters applied');
  });

  /* SEGMENTS */
  function setSegment(which){
    segSearch.dataset.active = which==='search';
    segAll.dataset.active = which==='all';
    if (which==='search'){
      searchSection.classList.remove('hidden');
      viewAllSection.classList.add('hidden');
      resultsGrid.innerHTML = '';
      detailsPanel.classList.add('hidden');
    } else {
      searchSection.classList.add('hidden');
      viewAllSection.classList.remove('hidden');
      detailsPanel.classList.add('hidden');
      renderCurrentKindCards(applyFilterSet());
    }
  }
  segSearch.addEventListener('click', ()=> setSegment('search'));
  segAll.addEventListener('click', ()=> setSegment('all'));

  /* IMAGE HANDLER (details) */
  function setDetailImage(src){
    const img = document.getElementById('d-img');
    const ph  = document.getElementById('d-img-ph');
    const showPlaceholder = () => {
      img.src = '';
      img.classList.add('hidden');
      ph.classList.remove('hidden');
    };
    if (!src || !String(src).trim()) { showPlaceholder(); return; }
    img.onload = () => { img.classList.remove('hidden'); ph.classList.add('hidden'); };
    img.onerror = showPlaceholder;
    img.src = src;
  }

  /* GRID CARDS – uniform layout for image/no-image */
    function renderProfileCards(items){
    resultsGrid.innerHTML = '';
    if (!items.length){
      resultsGrid.innerHTML = '<div class="col-span-full text-center subtitle-text py-8">No profiles match the filters.</div>';
      return;
    }
    items.forEach(p=>{
      const hasImg = !!String(p.image || '').trim();
      const el = document.createElement('div');
      el.className = 'card p-4 hover:shadow-xl transition cursor-pointer';

      el.innerHTML = `
        <div class="flex items-center gap-4">
          <div class="relative">
            <img src="${hasImg ? p.image : ''}"
                 class="w-14 h-14 object-contain rounded-lg border border-slate-700 bg-white"
                 alt=""
                 style="display:${hasImg ? 'block' : 'none'}"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='grid';">
            <div class="img-ph" style="display:${hasImg ? 'none' : 'grid'};">No image</div>
          </div>
          <div class="min-w-0 flex-1">
            <div class="font-semibold truncate">${p.description || '—'}</div>
            <div class="text-xs subtitle-text mt-0.5 truncate">${p.profile_code || '—'} • ${p.system || ''}</div>
          </div>
          <span class="chip ${statusClass(p.inventory)}">${p.inventory || '—'}</span>
        </div>`;

      el.addEventListener('click', ()=> renderProfileDetails(p));
      resultsGrid.appendChild(el);
    });
  }

  function renderAccessoryCards(items){
    resultsGrid.innerHTML = '';
    if (!items.length){
      resultsGrid.innerHTML = '<div class="col-span-full text-center subtitle-text py-8">No accessories match the filters.</div>';
      return;
    }
    items.forEach(a=>{
      const hasImg = !!String(a.image || '').trim();
      const el = document.createElement('div');
      el.className = 'card p-4 hover:shadow-xl transition cursor-pointer';

      el.innerHTML = `
        <div class="flex items-center gap-4">
          <div class="relative">
            <img src="${hasImg ? a.image : ''}"
                 class="w-14 h-14 object-contain rounded-lg border border-slate-700 bg-white"
                 alt=""
                 style="display:${hasImg ? 'block' : 'none'}"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='grid';">
            <div class="img-ph" style="display:${hasImg ? 'none' : 'grid'};">No image</div>
          </div>
          <div class="min-w-0 flex-1">
            <div class="font-semibold truncate">${a.description || '—'}</div>
            <div class="text-xs subtitle-text mt-0.5 truncate">${a.code || '—'} • ${a.supplier_name || '—'}</div>
          </div>
          <span class="chip ${statusClass(a.status)}">${a.status || '—'}</span>
        </div>`;

      el.addEventListener('click', ()=> renderAccessoryDetails(a));
      resultsGrid.appendChild(el);
    });
  }

  function renderCurrentKindCards(items){
    if (kindSel.value==='profile') renderProfileCards(items);
    else renderAccessoryCards(items);
  }

  /* SHORTCUTS */
  document.addEventListener('keydown', (e)=>{
    const tag = e.target?.tagName || '';
    const typing = ['INPUT','TEXTAREA','SELECT'].includes(tag) || e.target?.isContentEditable;
    if (typing || e.ctrlKey || e.metaKey || e.altKey) return;
    const k = e.key.toLowerCase();
    if (k==='a'){ setSegment('all'); }
    if (k==='f'){ openFilters(); }
  });

  /* SUGGESTIONS */
  function renderSuggestion(rec, kind){
    const code = kind==='profile' ? s(rec.profile_code) : s(rec.code);
    const desc = s(rec.description);
    const minor = kind==='profile' ? s(rec.system) : s(rec.supplier_name);
    const li = document.createElement('li');
    li.className = 'px-3 py-2 hover:bg-black/20 rounded cursor-pointer';
    li.innerHTML = `
      <div class="font-medium truncate">${desc || code || '—'}</div>
      <div class="text-xs subtitle-text truncate">${code}${minor ? ' • ' + minor : ''}</div>
    `;
    li.addEventListener('click', ()=>{
      q.value = (kind==='profile' ? desc : code) || '';
      if (kind==='profile') renderProfileDetails(rec); else renderAccessoryDetails(rec);
      sugWrap.classList.add('hidden');
    });
    sugList.appendChild(li);
  }

  function updateSuggestions(){
    const query = s(q.value).trim().toLowerCase();
    if (!query){ sugWrap.classList.add('hidden'); return; }
    const kind = kindSel.value;
    let list = [];
    if (kind==='profile'){
      list = INVget().filter(r =>
        s(r.profile_code).toLowerCase().includes(query) ||
        s(r.description).toLowerCase().includes(query) ||
        s(r.system).toLowerCase().includes(query)
      );
    } else {
      list = ACCget().filter(a =>
        s(a.code).toLowerCase().includes(query) ||
        s(a.description).toLowerCase().includes(query) ||
        s(a.supplier_name).toLowerCase().includes(query)
      );
    }
    sugList.innerHTML = '';
    (list.slice(0,10)).forEach(item => renderSuggestion(item, kind));
    sugWrap.classList.toggle('hidden', list.length===0);
  }
  q.addEventListener('input', updateSuggestions);
  q.addEventListener('focus', updateSuggestions);
  document.addEventListener('click',(e)=>{ if (!q.closest('div.relative')?.contains(e.target)) sugWrap.classList.add('hidden'); });

  /* DETAILS */
  function toggleGrid(gridId, containerId, obj, kind){
    const grid = $(gridId);
    const container = $(containerId);
    const titleEl = container.querySelector('div');
    const entries = Object.entries(obj||{}).filter(([_,v])=> v && v!=='0');
    titleEl.textContent = kind==='profile' ? titleEl.dataset.profileTitle : titleEl.dataset.accessoryTitle;
    grid.innerHTML = '';
    if (!entries.length){ container.style.display='none'; return; }
    container.style.display='block';
    entries.forEach(([k,v])=>{
      const cell = document.createElement('div');
      cell.className = 'card p-3';
      cell.innerHTML = `<div class="text-xs subtitle-text">${k}</div><div class="font-medium">${v}</div>`;
      grid.appendChild(cell);
    });
  }

  function showHideDetailFields(isProfile){
    const profileIds = ['d-pdesc-container','d-alloy-container','d-system-container','d-finish-container','d-length-container','d-supported-profile-container'];
    const accIds = ['d-atype-container','d-mrp-container','d-uom-container','d-scode-container'];
    profileIds.forEach(id => $(id).style.display = isProfile ? 'block' : 'none');
    accIds.forEach(id => $(id).style.display = isProfile ? 'none' : 'block');
    $('d-supplier-container').style.display = 'block';
  }

  function setSupportChip(isSupported){
    const chip = document.getElementById('d-status-chip');
    chip.textContent = isSupported ? 'Supported profile' : 'Not Supported profile';
    chip.className = `chip ${isSupported ? 'ok' : 'bad'} mt-2`;
  }

  function renderProfileDetails(rec){
    document.querySelectorAll('.tab-btn').forEach(b=>{ b.classList.remove('active'); b.style.borderColor='transparent'; });
    document.querySelector('.tab-btn[data-tab="general"]').classList.add('active');
    document.querySelectorAll('.tab-content').forEach(c=>c.classList.add('hidden'));
    $('general-tab').classList.remove('hidden');
    $('profile-accessory-tab-btn').textContent = 'Profile Data';
    showHideDetailFields(true);

    setDetailImage(String(rec.image) || null);
    $('d-code').textContent = String(rec.description) || '—';
    const supported = (String(rec.length || '').trim() && String(rec.length).trim() !== '0');
    $('d-supported-profile').textContent = supported ? 'Yes' : 'No';
    setSupportChip(supported);

    $('d-desc').textContent = s(rec.profile_code) || '—';
    $('d-pdesc').textContent = s(rec.profile_title) || 'N/A';
    $('d-alloy').textContent = s(rec.alloy) || 'N/A';
    $('d-system').textContent = s(rec.system) || 'N/A';
    $('d-finish').textContent = s(rec.finish) || 'N/A';
    $('d-length').textContent = s(rec.length) || 'N/A';
    $('d-supplier').textContent = Object.keys(rec.suppliers||{}).filter(k => rec.suppliers[k] && rec.suppliers[k]!=='0').join(', ') || 'N/A';
    $('d-ware-rack').textContent = `${s(rec.warehouse_no) || 'N/A'} / ${s(rec.rack_no) || 'N/A'}`;

    toggleGrid('d-supplier-grid','d-supplier-grid-container', rec.suppliers, 'profile');
    toggleGrid('d-sides-grid','d-sides-grid-container', rec.sides, 'profile');
    toggleGrid('d-poly-grid','d-poly-grid-container', rec.polyamide, 'profile');

    detailsPanel.classList.remove('hidden');
    detailsPanel.scrollIntoView({ behavior:'smooth', block:'start' });
  }

  function renderAccessoryDetails(a){
    document.querySelectorAll('.tab-btn').forEach(b=>{ b.classList.remove('active'); b.style.borderColor='transparent'; });
    document.querySelector('.tab-btn[data-tab="general"]').classList.add('active');
    document.querySelectorAll('.tab-content').forEach(c=>c.classList.add('hidden'));
    $('general-tab').classList.remove('hidden');
    $('profile-accessory-tab-btn').textContent = 'Accessories Data';
    showHideDetailFields(false);

    setDetailImage(s(a.image) || null);
    $('d-code').textContent = s(a.code) || '—';
    $('d-status-chip').textContent = s(a.status) || '—';
    $('d-status-chip').className = `chip ${statusClass(a.status)} mt-2`;
    $('d-desc').textContent = s(a.description) || '—';
    $('d-atype').textContent = s(a.accessory_type) || 'N/A';
    $('d-mrp').textContent = s(a.mrp_comments) || 'N/A';   /* <-- now populated */
    $('d-uom').textContent = s(a.uom) || 'N/A';
    $('d-scode').textContent = s(a.supplier_code) || 'N/A';
    $('d-supplier').textContent = s(a.supplier_name) || 'N/A';
    $('d-ware-rack').textContent = `${s(a.warehouse_no) || 'N/A'} / ${s(a.rack_no) || 'N/A'}`;

    toggleGrid('d-supplier-grid','d-supplier-grid-container', a.supplier_codes, 'accessory');
    $('d-sides-grid-container').style.display = 'none';
    toggleGrid('d-poly-grid','d-poly-grid-container', a.other_color_codes, 'accessory');

    detailsPanel.classList.remove('hidden');
    detailsPanel.scrollIntoView({ behavior:'smooth' });
  }

  /* EXPORTS */
  function getFilteredDataForExport(){
    const text = s(q.value).trim().toLowerCase();
    const kind = kindSel.value;
    const rows = kind==='profile' ? INVget() : ACCget();
    return rows.filter(r=>{
      if (kind==='profile'){
        return s(r.profile_code).toLowerCase().includes(text) ||
               s(r.description).toLowerCase().includes(text) ||
               s(r.system).toLowerCase().includes(text);
      } else {
        return s(r.code).toLowerCase().includes(text) ||
               s(r.description).toLowerCase().includes(text) ||
               s(r.supplier_name).toLowerCase().includes(text);
      }
    });
  }
  function exportToCsv(){
    const kind = kindSel.value;
    const dataRows = getFilteredDataForExport();
    if (!dataRows.length){ toast('No data to export','rgba(245,158,11,.95)'); return; }
    const headers = kind==='profile' ? ['Profile Code','Description','System','Status','Warehouse/Rack']
                                     : ['Code','Description','Type','Supplier','Status','Warehouse/Rack'];
    const lines = [headers.join(',')];
    dataRows.forEach(item=>{
      if (kind==='profile'){
        lines.push([s(item.profile_code), s(item.description), s(item.system), s(item.inventory), `${s(item.warehouse_no)||'N/A'}/${s(item.rack_no)||'N/A'}`].map(v=>`"${(v||'').toString().replace(/"/g,'""')}"`).join(','));
      } else {
        lines.push([s(item.code), s(item.description), s(item.accessory_type), s(item.supplier_name), s(item.status), `${s(item.warehouse_no)||'N/A'}/${s(item.rack_no)||'N/A'}`].map(v=>`"${(v||'').toString().replace(/"/g,'""')}"`).join(','));
      }
    });
    const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8;'});
    const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = `${kind}_search_results.csv`; link.click();
    toast('CSV exported');
  }
  function exportToPdf(){
    const kind = kindSel.value;
    const rows = getFilteredDataForExport();
    if (!rows.length){ toast('No data to export','rgba(245,158,11,.95)'); return; }
    const { jsPDF } = window.jspdf; const doc = new jsPDF();
    const headers = kind==='profile' ? [['Profile Code','Description','System','Status','Warehouse/Rack']]
                                     : [['Code','Description','Type','Supplier','Status','Warehouse/Rack']];
    const body = rows.map(item=>{
      if (kind==='profile') return [s(item.profile_code), s(item.description), s(item.system), s(item.inventory), `${s(item.warehouse_no)||'N/A'}/${s(item.rack_no)||'N/A'}`];
      return [s(item.code), s(item.description), s(item.accessory_type), s(item.supplier_name), s(item.status), `${s(item.warehouse_no)||'N/A'}/${s(item.rack_no)||'N/A'}`];
    });
    if (doc.autoTable){ doc.autoTable({ head:headers, body, startY:20, headStyles:{ fillColor:[245,158,11], textColor:[0,0,0] }, styles:{ fontSize:8 } }); }
    else { let y=20; doc.text((headers[0]||[]).join(' | '), 10, y); y+=8; body.forEach(r=>{ doc.text(r.join(' | ').slice(0,95), 10, y); y+=6; }); }
    doc.save(`${kind}_search_results.pdf`);
    toast('PDF exported');
  }
  $('exportCsvBtn').addEventListener('click', exportToCsv);
  $('exportPdfBtn').addEventListener('click', exportToPdf);

  /* TAB BUTTONS */
  document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      document.querySelectorAll('.tab-btn').forEach(b=> b.classList.remove('active'));
      e.currentTarget.classList.add('active');
      document.querySelectorAll('.tab-content').forEach(c=> c.classList.add('hidden'));
      $(e.currentTarget.dataset.tab + '-tab').classList.remove('hidden');
    });
  });

  /* KIND CHANGE */
  kindSel.addEventListener('change', () => {
    q.value = '';
    sugWrap.classList.add('hidden');
    detailsPanel.classList.add('hidden');
    setFilterModeByKind();
    if (segAll.dataset.active === "true") {
      renderCurrentKindCards(applyFilterSet());
    }
  });

  /* START */
  function initialRender(){
    populateProfileFilterSelects();
    populateAccessoryFilterSelect();
    refreshCountsAndLabels();
    setFilterModeByKind();
    setSegment('search');
  }
  initialRender();
});
</script>
<!-- MARKER: Alumil Mobile Bottom Nav + Footer (v1) -->
<div id="alumil-bottom-safe-pad" style="height: calc(88px + env(safe-area-inset-bottom, 0px));"></div>
<nav aria-label="Primary" class="alumil-bottom-nav" id="alumil-bottom-nav">
<button aria-label="Home" class="nav-btn" data-nav="home" onclick="location.href='home.html'">
<svg class="lucide lucide-home" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
<span>Home</span>
</button>
<button aria-label="Admin" class="nav-btn" data-nav="admin" onclick="location.href='admin.html'">
<svg class="lucide lucide-settings-2" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M20 7h-9"></path>
<path d="M14 17h-5"></path>
<circle cx="17" cy="17" r="3"></circle>
<circle cx="7" cy="7" r="3"></circle>
</svg>
<span>Admin</span>
</button>
<button aria-label="Barcode scan (open)" class="btn-scan" id="alumil-scan-btn">
<svg class="lucide lucide-scan-line" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M3 7V5a2 2 0 0 1 2-2h2"></path>
<path d="M17 3h2a2 2 0 0 1 2 2v2"></path>
<path d="M21 17v2a2 2 0 0 1-2 2h-2"></path>
<path d="M7 21H5a2 2 0 0 1-2-2v-2"></path>
</svg>
</button>
<button aria-label="Rack Label" class="nav-btn" data-nav="rack" onclick="location.href='rack-label-printing.html'">
<svg class="lucide lucide-package" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="m7.5 4.27 9 5.15"></path>
<path d="M21 8.24v9.42a2 2 0 0 1-1 .51l-8 2.8a2 2 0 0 1-2 0l-8-2.8a2 2 0 0 1-1-.51V8.24a2 2 0 0 1 1-.51Z"></path>
<path d="m3.29 7.39 8.31 3.23"></path>
<path d="m12 22.95 8.71-3.26"></path>
</svg>
<span>Rack Label</span>
</button>
<button aria-label="Search Inventory" class="nav-btn" data-nav="search" onclick="location.href='search-inventory.html'">
<svg class="lucide lucide-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<circle cx="11" cy="11" r="8"></circle>
<path d="m21 21-4.3-4.3"></path>
</svg>
<span>Search</span>
</button>
</nav>
<footer class="alumil-footer" id="alumil-fixed-footer" role="contentinfo">
<small>Alumil Inventory App @2025</small>
</footer>
<input aria-hidden="true" autocapitalize="off" autocomplete="off" class="alumil-scan-input" id="alumil-scan-input" inputmode="none" spellcheck="false" type="text"/>
<style>
  .alumil-bottom-nav {
    position: fixed; left: 0; right: 0;
    bottom: calc(28px + env(safe-area-inset-bottom, 0px));
    margin: 0 auto; z-index: 60;
    display: grid; grid-template-columns: 1fr 1fr auto 1fr 1fr;
    align-items: center; max-width: 720px;
    padding: 10px 12px;
    background: rgba(15, 23, 42, .92); color: #e5e7eb;
    border: 1px solid rgba(255,255,255,.08); border-radius: 16px;
    backdrop-filter: blur(10px) saturate(140%); -webkit-backdrop-filter: blur(10px) saturate(140%);
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  html[data-theme="light"] .alumil-bottom-nav { background: rgba(255,255,255,.96); color:#111827; border-color: rgba(0,0,0,.06); }
  .alumil-bottom-nav .nav-btn { display: inline-flex; flex-direction: column; align-items: center; gap: 4px; background: transparent; border:0; color: inherit; font-weight: 600; font-size: 12px; padding: 6px 8px; border-radius: 10px; }
  .alumil-bottom-nav .nav-btn:hover { background: rgba(255,255,255,.06); }
  html[data-theme="light"] .alumil-bottom-nav .nav-btn:hover { background: rgba(0,0,0,.04); }
  .scan-btn { position: relative; width: 56px; height: 56px; display: inline-grid; place-items: center; border-radius: 14px; border: 0; background: #facc15; color: #111827; box-shadow: 0 0 0 0 rgba(250,204,21,0); transition: transform .15s, box-shadow .2s; }
  .scan-btn:hover { transform: translateY(-1px); box-shadow: 0 0 0 8px rgba(250,204,21,.2); }
  .scan-btn:active { transform: translateY(0); }
  .scan-btn i { width: 28px; height: 28px; }
  .alumil-footer { position: fixed; left:0; right:0; bottom: 0; z-index: 50; display:flex; align-items:center; justify-content:center; min-height: 24px; background: #0b1220; color:#cbd5e1; border-top: 1px solid rgba(255,255,255,.08); padding-bottom: env(safe-area-inset-bottom, 0px); font-size: 12px; letter-spacing: .02em; }
  html[data-theme="light"] .alumil-footer { background:#f8fafc; color:#334155; border-top-color: rgba(0,0,0,.06); }
  @media (min-width: 1025px) { #alumil-bottom-safe-pad, #alumil-bottom-nav, #alumil-fixed-footer { display: none !important; } }
  .alumil-scan-input { position: fixed; left: -9999px; width: 1px; height: 1px; opacity: 0; }
</style>
<script>
(function(){
  function routeByCode(raw){
    if(!raw) return;
    const code = String(raw).trim();
    if(!code) return;
    const isAcc = /(\bACC\b|^ACC-|ACC\d|ACCESS|ACCS)/i.test(code);
    const target = isAcc ? 'acc-label-printing.html' : 'profile-label-printing.html';
    const url = target + '?code=' + encodeURIComponent(code);
    window.location.href = url;
  }
  // Keyboard wedge capture
  (function(){
    let buf = '', last = 0;
    window.addEventListener('keydown', (e) => {
      const now = Date.now();
      if(now - last > 250) buf = '';
      last = now;
      if(e.key === 'Enter'){
        if(buf.length >= 4){ routeByCode(buf); }
        buf = ''; return;
      }
      if(e.ctrlKey || e.metaKey || e.altKey) return;
      if(e.key && e.key.length === 1){ buf += e.key; }
    }, true);
  })();
  // Hidden input focus via big button
  const scanBtn = document.getElementById('alumil-scan-btn');
  const scanInput = document.getElementById('alumil-scan-input');
  if(scanBtn && scanInput){
    scanBtn.addEventListener('click', () => {
      scanInput.value = ''; scanInput.focus();
      try {
        if(!document.getElementById('alumil-scan-toast')){
          const t = document.createElement('div');
          t.id = 'alumil-scan-toast';
          t.textContent = 'Ready to scan… (press Enter when done)';
          t.style.position='fixed'; t.style.left='50%'; t.style.bottom='90px'; t.style.transform='translateX(-50%)';
          t.style.background='rgba(0,0,0,.72)'; t.style.color='#fff'; t.style.font='600 12px/1.1 Inter,system-ui';
          t.style.padding='8px 12px'; t.style.borderRadius='10px'; t.style.zIndex=80;
          document.body.appendChild(t); setTimeout(()=>{ t.remove(); }, 2000);
        }
      } catch(e){}
    });
    scanInput.addEventListener('keydown', (e) => {
      if(e.key === 'Enter'){
        e.preventDefault();
        routeByCode(scanInput.value);
        scanInput.blur();
      }
    });
  }
  // Active tab highlight
  try{
    const here = location.pathname.split('/').pop().toLowerCase();
    document.querySelectorAll('#alumil-bottom-nav .nav-btn').forEach(btn => {
      const k = btn.getAttribute('data-nav'); if(!k) return;
      const map = { home:'home.html', admin:'admin.html', rack:'rack-label-printing.html', search:'search-inventory.html' };
      if(map[k] && here === map[k].toLowerCase()){ btn.style.fontWeight='800'; btn.style.opacity='1'; }
      else { btn.style.opacity='.85'; }
    });
  }catch(e){}
})();
</script>
<script>
(function(){
  try{
    var path = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
    var home = document.querySelector('[data-nav="home"]');
    var admin = document.querySelector('[data-nav="admin"]');
    function addActive(el){ if(!el) return; el.classList.add('text-yellow-400'); el.classList.add('font-semibold'); }
    if(path === 'admin.html'){ addActive(admin); }
    else if(path === 'home.html' || path === 'index.html' || path === ''){ addActive(home); }
  }catch(e){}
  try{ if(window.lucide && window.lucide.createIcons){ window.lucide.createIcons(); } }catch(e){}
})();
</script>
<script>
// Versioned global bootstrap (SharePoint + Config)
document.addEventListener('DOMContentLoaded', async () => {
  const BASE = "https://alumildxb-my.sharepoint.com/:x:/g/personal/a_olivero_alumil_ae/EVlOY6zQ8SRJmM9696IevO8BpoiOXwkzFe88_yRNe2kC2A?e=tfIbS3";
  async function j(u){
  // If we're pointing at a SharePoint Excel link, emulate the old JSON API:
  if ((typeof BASE === "string") && BASE.includes("sharepoint.com")) {
    // Ensure loader + workbook
    if (typeof loadWorkbook !== "function") {
      throw new Error("XLSX loader not found. Ensure xlsx.full.min.js and js/sharepoint_loader.js are loaded.");
    }
    if (!window.__SP_WB_LOADED__) {
      await loadWorkbook(BASE);
      window.__SP_WB_LOADED__ = true;
    }
    // Extract sheet=Name from the URL and return rows from that sheet
    try {
      const qs = (u.split("?")[1] || "");
      const params = new URLSearchParams(qs);
      const sheet = params.get("sheet") || "Config";
      const rows = getSheetJSON(sheet);
      return rows || [];
    } catch (e) {
      console.error("SharePoint sheet load failed:", e);
      return [];
    }
  }

  // Fallback: original JSON fetch behavior
  const r = await fetch(u, {mode:'cors'});
  if(!r.ok) throw 0;
  return r.json();
}

); if(!r.ok) throw 0; return r.json(); }

  // 1) Local cache + version
  let local = {}, localVersion = null;
  try { local = JSON.parse(localStorage.getItem('excelCache') || '{}'); localVersion = local?.version || null; } catch { local = {}; }

  // 2) Remote config (version, sheet names)
  let cfg = { version: null, sheetProfiles: "Profile", sheetAccessories: "Accessories" };
  try {
    const rows = await j(BASE + (BASE.includes('?')?'&':'?') + 'sheet=Config');
    const map = Object.fromEntries((rows || []).filter(r => r && r.key).map(r => [r.key, r.value]));
    cfg = Object.assign(cfg, map);
  } catch (_){
    // no Config found -> force refresh
  }

  const remoteVersion = cfg.version || null;
  const hasData = (Array.isArray(local?.profiles) && local.profiles.length) || (Array.isArray(local?.accessories) && local.accessories.length);

  // 3) If same version and have data -> keep cache
  if (remoteVersion && localVersion && remoteVersion === localVersion && hasData) return;

  // 4) Fetch fresh data from configured sheets
  try {
    const urlP = BASE + (BASE.includes('?')?'&':'?') + 'sheet=' + encodeURIComponent(cfg.sheetProfiles || 'Profile');
    const urlA = BASE + (BASE.includes('?')?'&':'?') + 'sheet=' + encodeURIComponent(cfg.sheetAccessories || 'Accessories');
    const [p, a] = await Promise.all([ j(urlP), j(urlA) ]);
    const profiles = Array.isArray(p) ? p : (p?.data || []);
    const accessories = Array.isArray(a) ? a : (a?.data || []);

    localStorage.setItem('excelCache', JSON.stringify({
      profiles, accessories,
      version: remoteVersion,
      fileName: `SharePoint: ${cfg.sheetProfiles} + ${cfg.sheetAccessories}`,
      loadedAt: new Date().toISOString()
    }));
    console.log('[bootstrap] excelCache updated to version', remoteVersion);
  } catch (e) {
    console.warn('Versioned bootstrap failed:', e);
  }
});
</script>
<script src="js/sharepoint_loader.js"></script>
<!-- Footer -->
<footer class="alumil-footer">
<p>Alumil Labeling App @2025</p>
</footer>

<!-- Global Data Service for inventory access -->
<script src="js/data-service.js"></script>
</body>
</html>
