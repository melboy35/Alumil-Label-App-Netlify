<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign In | Alumil Inventory System</title>
  
  <!-- Comprehensive Favicon Setup -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
  <link rel="manifest" href="/favicon/site.webmanifest">
  <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#ffc107">
  <meta name="msapplication-TileColor" content="#ffc107">
  <meta name="msapplication-config" content="/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="../assets/css/logo-theme.css">
  <!-- Brand CSS removed -->

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --panel-bg: rgba(60, 60, 60, 0.55);
      --panel-border: rgba(255,255,255,.15);
      --text: #eaeaea;
      --muted: #d6d6d6;
      --blue: #2a7de1;      /* primary button */
      --blue-press: #1f66bd;
      --yellow: #d9b531;     /* separators */
      --input-bg: rgba(255,255,255,.08);
      --input-border: rgba(255,255,255,.2);
      --shadow: 0 18px 45px rgba(0,0,0,.25);
      --radius: 12px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      color: var(--text);
      display: grid;
      place-items: center;
      background: #111;
      overflow: hidden;
    }

    /* Background with Alumil branding */
    .bg {
      position: fixed; inset: 0;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      z-index: -1;
    }

    /* Optional: Add subtle pattern overlay */
    .bg::after {
      content: '';
      position: absolute;
      inset: 0;
      background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 193, 7, 0.1) 0%, transparent 50%);
    }

    .panel {
      width: min(420px, calc(100vw - 32px));
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      backdrop-filter: blur(6px);
      box-shadow: var(--shadow);
      border-radius: 16px;
      padding: 28px 26px;
      position: relative;
      z-index: 1;
    }

    .brand {
      display:flex; align-items:center; justify-content:center;
      margin-bottom: 14px;
      user-select:none;
    }
    .brand img { height: 40px; opacity: .95; }

    .flags {
      display:flex; gap: 10px; justify-content:center; margin: 8px 0 18px;
      opacity:.95; flex-wrap: wrap;
    }
    .flag {
      width: 20px; height: 14px; border-radius: 2px;
      background: #bbb; box-shadow: 0 0 0 1px rgba(255,255,255,.25) inset;
      cursor: pointer;
    }
    .flag:hover { transform: scale(1.1); }

    /* Country flag colors */
    .flag-gr { background: linear-gradient(to bottom, #0d5eaf 0%, #0d5eaf 50%, #ffffff 50%, #ffffff 100%); }
    .flag-ro { background: linear-gradient(to right, #002b7f 0%, #002b7f 33%, #fcd116 33%, #fcd116 66%, #ce1126 66%); }
    .flag-bg { background: linear-gradient(to bottom, #ffffff 0%, #ffffff 33%, #00966e 33%, #00966e 66%, #d62612 66%); }
    .flag-pl { background: linear-gradient(to bottom, #ffffff 0%, #ffffff 50%, #dc143c 50%); }
    .flag-rs { background: linear-gradient(to bottom, #c6363c 0%, #c6363c 33%, #0c4076 33%, #0c4076 66%, #ffffff 66%); }
    .flag-al { background: #e41e20; }
    .flag-mk { background: linear-gradient(to bottom, #d20000 0%, #d20000 50%, #ffce00 50%); }

    h1 {
      text-align:center; margin: 6px 0 8px; font-size: 24px; font-weight: 600; letter-spacing:.2px;
    }

    .subtitle {
      text-align: center; 
      color: var(--muted); 
      font-size: 14px; 
      margin-bottom: 24px;
      font-weight: 400;
    }

    .form-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
    }

    input[type="email"], input[type="password"] {
      width: 100%;
      padding: 12px 16px;
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: var(--radius);
      color: var(--text);
      font-size: 15px;
      transition: all 0.2s ease;
    }

    input[type="email"]:focus, input[type="password"]:focus {
      outline: none;
      border-color: var(--blue);
      box-shadow: 0 0 0 2px rgba(42, 125, 225, 0.2);
    }

    input[type="email"]::placeholder, input[type="password"]::placeholder {
      color: var(--muted);
    }

    .btn {
      display:flex; align-items:center; justify-content:center;
      gap:10px; width:100%;
      padding: 14px 16px; border-radius: var(--radius);
      text-decoration:none; color:#fff; font-weight: 600;
      background: var(--blue);
      box-shadow: 0 6px 14px rgba(42,125,225,.35);
      transition: transform .04s ease, background .15s ease, box-shadow .15s ease;
      border: 0;
      cursor: pointer;
      font-size: 15px;
      margin-top: 8px;
    }
    .btn:active { transform: translateY(1px); background: var(--blue-press); box-shadow: 0 4px 10px rgba(42,125,225,.28); }
    .btn:hover { box-shadow: 0 8px 18px rgba(42,125,225,.45); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }

    .login-icon {
      width: 18px; height: 18px; display:inline-block;
      background: currentColor;
      mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpath d='M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4'/%3E%3Cpolyline points='10,17 15,12 10,7'/%3E%3Cline x1='15' y1='12' x2='3' y2='12'/%3E%3C/svg%3E") center/contain no-repeat;
    }

    .divider {
      display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:12px;
      color: var(--muted); font-size: 12px; margin: 20px 0;
    }
    .divider::before, .divider::after {
      content:""; height: 2px; background: linear-gradient(90deg, transparent, var(--yellow), transparent);
      border-radius: 2px;
    }

    .actions { display:flex; gap:10px; margin-top: 14px; }
    .ghost {
      flex:1;
      display:flex; align-items:center; justify-content:center;
      padding: 12px 14px; border-radius: var(--radius);
      text-decoration:none; color:#eaeaea; font-weight: 500;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      transition: all 0.2s ease;
      font-size: 14px;
    }
    .ghost:hover {
      background: rgba(255,255,255,.12);
      border-color: rgba(255,255,255,.3);
    }

    .muted { color: var(--muted); text-align:center; font-size: 12px; margin-top:14px; }

    .error-message {
      background: rgba(255, 80, 80, .12);
      color: #ffd1d1;
      border: 1px solid rgba(255, 120, 120, .25);
      padding: 10px 12px; border-radius: 10px; font-size: 13px; margin-bottom: 14px;
      display: none;
    }

    @media (max-height: 620px) {
      .panel { transform: scale(.96); }
    }

    @media (max-width: 480px) {
      .panel { padding: 24px 20px; }
      h1 { font-size: 22px; }
      .actions { flex-direction: column; }
      .ghost { text-align: center; }
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>

  <main class="panel" role="main" aria-labelledby="title">
    <div class="brand">
  <div class="logo-container">
  <img src="../assets/images/alumil-logo black.svg" alt="Alumil Logo" loading="eager">
  </div>
    </div>

    <div class="flags" aria-label="Available regions">
      <div class="flag flag-gr" title="Greece"></div>
      <div class="flag flag-ro" title="Romania"></div>
      <div class="flag flag-bg" title="Bulgaria"></div>
      <div class="flag flag-pl" title="Poland"></div>
      <div class="flag flag-rs" title="Serbia"></div>
      <div class="flag flag-al" title="Albania"></div>
      <div class="flag flag-mk" title="North Macedonia"></div>
    </div>

    <h1 id="title">Sign In</h1>
    <p class="subtitle">Access your Inventory Management System</p>

    <div class="error-message" id="error-message"></div>

    <form id="login-form">
      <div class="form-group">
        <label for="email">Email Address</label>
        <input id="email" type="email" placeholder="Enter your email" required>
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input id="password" type="password" placeholder="Enter your password" required>
      </div>

      <button type="submit" class="btn" id="login-btn">
        <span class="login-icon" aria-hidden="true"></span>
        <span>Sign In</span>
      </button>
    </form>

    <div class="divider">OR</div>

    <div class="actions">
      <a class="ghost" href="/home.html">Continue as Guest</a>
      <a class="ghost" href="/admin.html">Admin Panel</a>
    </div>

    <p class="muted">Secure access to Alumil inventory system</p>
  </main>

  <script>
    const SUPABASE_URL = 'https://gkptehearoiapyujkuvc.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrcHRlaGVhcm9pYXB5dWprdXZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3ODgyMjgsImV4cCI6MjA3MTM2NDIyOH0.5F_dZECmQHGj7r8wsekm_pria4T6tVxnac_IA1qDvdQ';
    const supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    const loginForm = document.getElementById('login-form');
    const loginBtn = document.getElementById('login-btn');
    const errorMessage = document.getElementById('error-message');
    
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
    }
    
    function hideError() {
      errorMessage.style.display = 'none';
    }
    
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      hideError();
      
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      
      if (!email || !password) {
        showError('Please enter both email and password');
        return;
      }
      
      // Show loading state
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<span>Signing in...</span>';
      
      try {
        const { data, error } = await supa.auth.signInWithPassword({ email, password });
        
        if (error) {
          showError(error.message);
          return;
        }
        
        // Check user role after successful login
        const { data: profile, error: profileError } = await supa
          .from('profiles')
          .select('role')
          .eq('id', data.user.id)
          .single();
        
        if (profileError) {
          console.error('Error fetching profile:', profileError);
          // Default to home if profile fetch fails
          location.href = 'home.html';
          return;
        }
        
        // Route based on user role
        if (profile?.role === 'admin') {
          location.href = 'admin.html';
        } else {
          location.href = 'home.html';
        }
        
      } catch (err) {
        showError('An unexpected error occurred. Please try again.');
        console.error('Login error:', err);
      } finally {
        // Reset button state
        loginBtn.disabled = false;
        loginBtn.innerHTML = '<span class="login-icon" aria-hidden="true"></span><span>Sign In</span>';
      }
    });
    
    // Handle flag clicks for future internationalization
    document.querySelectorAll('.flag').forEach(flag => {
      flag.addEventListener('click', function() {
        const country = this.title;
        console.log(`Selected region: ${country}`);
        // Future: implement language/region switching
      });
    });
    
    // Add some visual feedback
    loginBtn.addEventListener('mousedown', function() {
      if (!this.disabled) {
        this.style.transform = 'translateY(1px)';
      }
    });

    loginBtn.addEventListener('mouseup', function() {
      this.style.transform = '';
    });

    loginBtn.addEventListener('mouseleave', function() {
      this.style.transform = '';
    });
  </script>
</body>
</html>